<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ğŸ¥¤ æ‘¸é±¼å¥¶èŒ¶è®° (LCç‰ˆ)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- å¼•å…¥ LeanCloud SDK -->
     <script src="https://cdn.bootcdn.net/ajax/libs/leancloud-storage/4.15.0/av-min.js"></script>
    <style>
        body { background-color: #fdfbf7; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }
        .btn-active:active { transform: scale(0.95); }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-4">

    <!-- æ‰‹æœºå¡ç‰‡å®¹å™¨ -->
    <div class="w-full max-w-md bg-white rounded-3xl shadow-xl overflow-hidden border border-amber-100">
        
        <!-- é¡¶éƒ¨ç»Ÿè®¡ -->
        <div class="bg-gradient-to-r from-orange-100 to-amber-200 p-8 text-center relative">
            <p class="text-amber-800 text-sm font-bold opacity-80 mb-1">æˆ‘çš„æœ¬æœˆæˆ˜ç»©</p>
            <h1 class="text-6xl font-black text-amber-900 drop-shadow-sm">
                <span id="localCount">0</span><span class="text-xl ml-1">æ¯</span>
            </h1>
            <!-- æ–°å¢ï¼šé‡ç½®æŒ‰é’® (æ¼”ç¤ºç”¨) -->
            <button onclick="resetCount()" class="mt-2 text-xs text-amber-700/40 hover:text-amber-800 underline">é‡ç½®è®¡æ•°</button>

            <div class="absolute top-4 right-4 text-2xl opacity-40 animate-bounce">ğŸ§‹</div>
        </div>

        <!-- æäº¤è¡¨å• -->
        <div class="p-6 space-y-5">
            
            <!-- æ˜µç§°è¾“å…¥ -->
            <div>
                <label class="block text-gray-500 text-xs font-bold mb-2 uppercase tracking-wide">ä½ çš„å¤§å (å¿…å¡«)</label>
                <div class="flex items-center bg-gray-50 border border-gray-200 rounded-xl px-4 py-3 focus-within:ring-2 focus-within:ring-amber-400 transition">
                    <i class="fas fa-user text-gray-400 mr-3"></i>
                    <input type="text" id="usernameInput" class="bg-transparent w-full focus:outline-none text-gray-700 font-bold" placeholder="æ¯”å¦‚ï¼šæ‘¸é±¼ç‹Alex">
                </div>
            </div>

            <!-- å“ç‰Œé€‰æ‹© -->
            <div>
                <label class="block text-gray-500 text-xs font-bold mb-2 uppercase tracking-wide">ä»Šæ—¥ç‰¹ä¾›</label>
                <div class="grid grid-cols-2 gap-3">
                    <button type="button" onclick="selectBrand(this, 'ç‘å¹¸ â˜•ï¸')" class="brand-btn border-2 border-gray-100 rounded-xl p-3 text-center hover:border-amber-400 focus:border-amber-500 transition btn-active">
                        <div class="text-2xl mb-1">â˜•ï¸</div>
                        <div class="text-sm font-bold text-gray-700">ç‘å¹¸</div>
                    </button>
                    <button type="button" onclick="selectBrand(this, 'æ˜Ÿå·´å…‹ ğŸ§œâ€â™€ï¸')" class="brand-btn border-2 border-gray-100 rounded-xl p-3 text-center hover:border-amber-400 focus:border-amber-500 transition btn-active">
                        <div class="text-2xl mb-1">ğŸ§œâ€â™€ï¸</div>
                        <div class="text-sm font-bold text-gray-700">æ˜Ÿå·´å…‹</div>
                    </button>
                    <button type="button" onclick="selectBrand(this, 'å–œèŒ¶ ğŸ‡')" class="brand-btn border-2 border-gray-100 rounded-xl p-3 text-center hover:border-amber-400 focus:border-amber-500 transition btn-active">
                        <div class="text-2xl mb-1">ğŸ‡</div>
                        <div class="text-sm font-bold text-gray-700">å–œèŒ¶</div>
                    </button>
                    <button type="button" onclick="selectBrand(this, 'èœœé›ª â›„ï¸')" class="brand-btn border-2 border-gray-100 rounded-xl p-3 text-center hover:border-amber-400 focus:border-amber-500 transition btn-active">
                        <div class="text-2xl mb-1">â›„ï¸</div>
                        <div class="text-sm font-bold text-gray-700">èœœé›ª</div>
                    </button>
                </div>
                <input type="hidden" id="selectedBrand">
            </div>

            <!-- å¿ƒæƒ…è¾“å…¥ -->
            <div>
                <label class="block text-gray-500 text-xs font-bold mb-2 uppercase tracking-wide">å£å‘³ / å¿ƒæƒ…</label>
                <textarea id="moodInput" rows="2" class="w-full bg-gray-50 border border-gray-200 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-amber-400 transition" placeholder="å†™ç‚¹ä»€ä¹ˆ..."></textarea>
            </div>

            <!-- æäº¤æŒ‰é’® -->
            <button id="submitBtn" onclick="submitData()" class="w-full bg-amber-500 hover:bg-amber-600 text-white text-lg font-bold py-4 rounded-2xl shadow-lg shadow-amber-200 btn-active transition flex items-center justify-center gap-2">
                <span>æ‰“å¡è®°å½•</span> <i class="fas fa-paper-plane"></i>
            </button>
            
            <p id="statusMsg" class="text-center text-xs text-gray-400 h-4"></p>
        </div>
    </div>

    <!-- LeanCloud Logic -->
    <script>
        // ============================================================
        // ğŸ”´ è®²å¸ˆæ³¨æ„ï¼šè¯·åœ¨è¿™é‡Œæ›¿æ¢ä¸ºä½ çš„ LeanCloud é…ç½®ä¿¡æ¯
        // å»ºè®®ä½¿ç”¨ LeanCloud å›½é™…ç‰ˆ (TapTap Developer Services) ä»¥å…å»å¤‡æ¡ˆçƒ¦æ¼
        // ============================================================
        const LC_CONFIG = {
            appId: "erfYQncVAuWBHo0dsyc82sWh-MdYXbMMI",
            appKey: "z7phvRItGIDs3mmiHx5XwGXb",
            serverURL: "https://erfyqncv.api.lncldglobal.com" // ä¾‹å¦‚: https://xxx.api.lncldglobal.com
        };
        // ============================================================

        // åˆå§‹åŒ– LeanCloud
        let isLCReady = false;
        try {
            if (LC_CONFIG.appId !== "YOUR_LEANCLOUD_APP_ID") {
                AV.init(LC_CONFIG);
                isLCReady = true;
                console.log("LeanCloud Initialized");
            }
        } catch (e) {
            console.error("LeanCloud Init Error:", e);
        }

        // é¡µé¢åŠ è½½
        window.onload = function() {
            document.getElementById('localCount').innerText = localStorage.getItem('myMilkTeaCount') || '0';
            document.getElementById('usernameInput').value = localStorage.getItem('myNickname') || '';
        };

        // æ–°å¢ï¼šé‡ç½®è®¡æ•°å‡½æ•°
        window.resetCount = function() {
            if(confirm('ç¡®å®šè¦æ¸…ç©ºæœ¬åœ°çš„è®¡æ•°è®°å½•å—ï¼Ÿ')) {
                localStorage.setItem('myMilkTeaCount', '0');
                document.getElementById('localCount').innerText = '0';
            }
        };

        // æäº¤æ•°æ®
        window.submitData = async function() {
            const btn = document.getElementById('submitBtn');
            const status = document.getElementById('statusMsg');
            const brand = document.getElementById('selectedBrand').value;
            const mood = document.getElementById('moodInput').value || "å¥½å–ï¼";
            const username = document.getElementById('usernameInput').value.trim();

            if (!username) { alert("è¯·å…ˆç•™ä¸‹ä½ çš„å¤§åï¼"); return; }
            if (!brand) { alert("è¯·å…ˆé€‰æ‹©ä¸€ä¸ªå“ç‰Œå“¦ï¼"); return; }

            localStorage.setItem('myNickname', username);
            
            // UI Loading
            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> æäº¤ä¸­...';

            try {
                // 1. æœ¬åœ°ä¿å­˜
                let count = parseInt(localStorage.getItem('myMilkTeaCount') || '0');
                count++;
                localStorage.setItem('myMilkTeaCount', count);
                document.getElementById('localCount').innerText = count;

                // 2. LeanCloud ä¿å­˜
                if (isLCReady) {
                    // å£°æ˜ Class (ç±»ä¼¼æ•°æ®åº“çš„è¡¨)
                    const Record = AV.Object.extend('MilkTeaRecords');
                    const record = new Record();
                    
                    record.set('username', username);
                    record.set('brand', brand);
                    record.set('mood', mood);
                    // è‡ªåŠ¨è®°å½• device info
                    record.set('device', navigator.userAgent);
                    
                    await record.save();
                    status.innerText = "âœ… å·²åŒæ­¥åˆ°å…¨å‘˜å¤§å±";
                    status.className = "text-center text-xs text-green-500 h-4 font-bold";
                } else {
                    status.innerText = "âš ï¸ ä»…æœ¬åœ°ä¿å­˜ (æœªé…ç½®åå°)";
                    status.className = "text-center text-xs text-amber-500 h-4";
                }

                // æˆåŠŸåŠ¨ç”»
                setTimeout(() => {
                    btn.innerHTML = '<span>æ‰“å¡è®°å½•</span> <i class="fas fa-check"></i>';
                    btn.className = "w-full bg-green-500 text-white text-lg font-bold py-4 rounded-2xl shadow-lg btn-active transition flex items-center justify-center gap-2";
                }, 500);

                setTimeout(() => {
                    btn.disabled = false;
                    btn.innerHTML = '<span>æ‰“å¡è®°å½•</span> <i class="fas fa-paper-plane"></i>';
                    btn.className = "w-full bg-amber-500 hover:bg-amber-600 text-white text-lg font-bold py-4 rounded-2xl shadow-lg shadow-amber-200 btn-active transition flex items-center justify-center gap-2";
                    document.getElementById('moodInput').value = '';
                    if(isLCReady) status.innerText = "";
                    document.querySelectorAll('.brand-btn').forEach(b => b.classList.remove('border-amber-500', 'bg-amber-50'));
                    document.getElementById('selectedBrand').value = '';
                }, 2000);

            } catch (error) {
                console.error("LC Error:", error);
                status.innerText = "âŒ ç½‘ç»œé”™è¯¯ï¼Œä»…æœ¬åœ°ä¿å­˜";
                status.className = "text-center text-xs text-red-400 h-4";
                btn.disabled = false;
                btn.innerText = "é‡è¯•";
            }
        };

        window.selectBrand = function(btn, value) {
            document.querySelectorAll('.brand-btn').forEach(b => {
                b.classList.remove('border-amber-500', 'bg-amber-50', 'ring-2', 'ring-amber-200');
                b.classList.add('border-gray-100');
            });
            btn.classList.remove('border-gray-100');
            btn.classList.add('border-amber-500', 'bg-amber-50', 'ring-2', 'ring-amber-200');
            document.getElementById('selectedBrand').value = value;
        };
    </script>
</body>

</html>
