<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ğŸ¥¤ æ‘¸é±¼å¥¶èŒ¶è®°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body { background-color: #fdfbf7; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }
        .btn-active:active { transform: scale(0.95); }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-4">

    <!-- æ‰‹æœºå¡ç‰‡å®¹å™¨ -->
    <div class="w-full max-w-md bg-white rounded-3xl shadow-xl overflow-hidden border border-amber-100">
        
        <!-- é¡¶éƒ¨ç»Ÿè®¡ -->
        <div class="bg-gradient-to-r from-orange-100 to-amber-200 p-8 text-center relative">
            <p class="text-amber-800 text-sm font-bold opacity-80 mb-1">æˆ‘çš„æœ¬æœˆæˆ˜ç»©</p>
            <h1 class="text-6xl font-black text-amber-900 drop-shadow-sm">
                <span id="localCount">0</span><span class="text-xl ml-1">æ¯</span>
            </h1>
            <div class="absolute top-4 right-4 text-2xl opacity-40 animate-bounce">ğŸ§‹</div>
        </div>

        <!-- æäº¤è¡¨å• -->
        <div class="p-6 space-y-5">
            
            <!-- ğŸŒŸ æ–°å¢ï¼šæ˜µç§°è¾“å…¥ -->
            <div>
                <label class="block text-gray-500 text-xs font-bold mb-2 uppercase tracking-wide">ä½ çš„å¤§å (å¿…å¡«)</label>
                <div class="flex items-center bg-gray-50 border border-gray-200 rounded-xl px-4 py-3 focus-within:ring-2 focus-within:ring-amber-400 transition">
                    <i class="fas fa-user text-gray-400 mr-3"></i>
                    <input type="text" id="usernameInput" class="bg-transparent w-full focus:outline-none text-gray-700 font-bold" placeholder="æ¯”å¦‚ï¼šæ‘¸é±¼ç‹Alex">
                </div>
            </div>

            <!-- å“ç‰Œé€‰æ‹© -->
            <div>
                <label class="block text-gray-500 text-xs font-bold mb-2 uppercase tracking-wide">ä»Šæ—¥ç‰¹ä¾›</label>
                <div class="grid grid-cols-2 gap-3">
                    <button type="button" onclick="selectBrand(this, 'ç‘å¹¸ â˜•ï¸')" class="brand-btn border-2 border-gray-100 rounded-xl p-3 text-center hover:border-amber-400 focus:border-amber-500 transition btn-active">
                        <div class="text-2xl mb-1">â˜•ï¸</div>
                        <div class="text-sm font-bold text-gray-700">ç‘å¹¸</div>
                    </button>
                    <button type="button" onclick="selectBrand(this, 'æ˜Ÿå·´å…‹ ğŸ§œâ€â™€ï¸')" class="brand-btn border-2 border-gray-100 rounded-xl p-3 text-center hover:border-amber-400 focus:border-amber-500 transition btn-active">
                        <div class="text-2xl mb-1">ğŸ§œâ€â™€ï¸</div>
                        <div class="text-sm font-bold text-gray-700">æ˜Ÿå·´å…‹</div>
                    </button>
                    <button type="button" onclick="selectBrand(this, 'å–œèŒ¶ ğŸ‡')" class="brand-btn border-2 border-gray-100 rounded-xl p-3 text-center hover:border-amber-400 focus:border-amber-500 transition btn-active">
                        <div class="text-2xl mb-1">ğŸ‡</div>
                        <div class="text-sm font-bold text-gray-700">å–œèŒ¶</div>
                    </button>
                    <button type="button" onclick="selectBrand(this, 'èœœé›ª â›„ï¸')" class="brand-btn border-2 border-gray-100 rounded-xl p-3 text-center hover:border-amber-400 focus:border-amber-500 transition btn-active">
                        <div class="text-2xl mb-1">â›„ï¸</div>
                        <div class="text-sm font-bold text-gray-700">èœœé›ª</div>
                    </button>
                </div>
                <input type="hidden" id="selectedBrand">
            </div>

            <!-- å¿ƒæƒ…è¾“å…¥ -->
            <div>
                <label class="block text-gray-500 text-xs font-bold mb-2 uppercase tracking-wide">å£å‘³ / å¿ƒæƒ…</label>
                <textarea id="moodInput" rows="2" class="w-full bg-gray-50 border border-gray-200 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-amber-400 transition" placeholder="å†™ç‚¹ä»€ä¹ˆ..."></textarea>
            </div>

            <!-- æäº¤æŒ‰é’® -->
            <button id="submitBtn" onclick="submitData()" class="w-full bg-amber-500 hover:bg-amber-600 text-white text-lg font-bold py-4 rounded-2xl shadow-lg shadow-amber-200 btn-active transition flex items-center justify-center gap-2">
                <span>æ‰“å¡è®°å½•</span> <i class="fas fa-paper-plane"></i>
            </button>
            
            <p id="statusMsg" class="text-center text-xs text-gray-400 h-4"></p>
        </div>
    </div>

    <!-- Firebase SDK Setup -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

        // ============================================================
        // ä½ çš„é…ç½® (å·²ä¿ç•™)
        // ============================================================
        const firebaseConfig = {
            apiKey: "AIzaSyDRQOohNRt0UjQD2voZ6gYeozKOy-uvM7E",
            authDomain: "milktea-demo-9025c.firebaseapp.com",
            projectId: "milktea-demo-9025c",
            storageBucket: "milktea-demo-9025c.firebasestorage.app",
            messagingSenderId: "356695291882",
            appId: "1:356695291882:web:3e85ca87492ec5b980e493"
        };
        // ============================================================

        // åˆå§‹åŒ– Firebase
        let db;
        try {
            const app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            console.log("Firebase Connected");
        } catch (e) {
            console.error("Firebase Init Error:", e);
            document.getElementById('statusMsg').innerText = "âš ï¸ æ•°æ®åº“æœªè¿æ¥";
        }

        // æš´éœ²ç»™å…¨å±€ä½œç”¨åŸŸ
        window.submitData = async function() {
            const btn = document.getElementById('submitBtn');
            const status = document.getElementById('statusMsg');
            const brand = document.getElementById('selectedBrand').value;
            const mood = document.getElementById('moodInput').value || "å¥½å–ï¼";
            // è·å–æ˜µç§°
            const username = document.getElementById('usernameInput').value.trim();

            if (!username) {
                alert("è¯·å…ˆç•™ä¸‹ä½ çš„å¤§åï¼");
                document.getElementById('usernameInput').focus();
                return;
            }
            if (!brand) {
                alert("è¯·å…ˆé€‰æ‹©ä¸€ä¸ªå“ç‰Œå“¦ï¼");
                return;
            }

            // ä¿å­˜æ˜µç§°åˆ°æœ¬åœ°ï¼Œä¸‹æ¬¡è‡ªåŠ¨å¡«
            localStorage.setItem('myNickname', username);

            // UI Loading
            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> æäº¤ä¸­...';

            try {
                // 1. æœ¬åœ°è®¡æ•°
                let count = parseInt(localStorage.getItem('myMilkTeaCount') || '0');
                count++;
                localStorage.setItem('myMilkTeaCount', count);
                document.getElementById('localCount').innerText = count;

                // 2. äº‘ç«¯å­˜å‚¨ (æ–°å¢ username å­—æ®µ)
                if (db) {
                    await addDoc(collection(db, "records"), {
                        username: username, // ğŸ‘ˆ æ–°å¢å­—æ®µ
                        brand: brand,
                        mood: mood,
                        timestamp: serverTimestamp(),
                        device: navigator.userAgent
                    });
                }

                // æˆåŠŸåé¦ˆ
                status.innerText = "âœ… å·²åŒæ­¥åˆ°å…¨å‘˜å¤§å±";
                status.className = "text-center text-xs text-green-500 h-4 font-bold";
                setTimeout(() => {
                    btn.innerHTML = '<span>æ‰“å¡è®°å½•</span> <i class="fas fa-check"></i>';
                    btn.className = "w-full bg-green-500 text-white text-lg font-bold py-4 rounded-2xl shadow-lg btn-active transition flex items-center justify-center gap-2";
                }, 500);

                setTimeout(() => {
                    btn.disabled = false;
                    btn.innerHTML = '<span>æ‰“å¡è®°å½•</span> <i class="fas fa-paper-plane"></i>';
                    btn.className = "w-full bg-amber-500 hover:bg-amber-600 text-white text-lg font-bold py-4 rounded-2xl shadow-lg shadow-amber-200 btn-active transition flex items-center justify-center gap-2";
                    document.getElementById('moodInput').value = '';
                    status.innerText = "";
                    document.querySelectorAll('.brand-btn').forEach(b => b.classList.remove('border-amber-500', 'bg-amber-50'));
                    document.getElementById('selectedBrand').value = '';
                }, 2000);

            } catch (error) {
                console.error("Error adding document: ", error);
                status.innerText = "âŒ ç½‘ç»œé”™è¯¯ï¼Œä»…æœ¬åœ°ä¿å­˜æˆåŠŸ";
                status.className = "text-center text-xs text-red-400 h-4";
                btn.disabled = false;
                btn.innerText = "é‡è¯•";
            }
        };

        // é¡µé¢åŠ è½½
        window.onload = function() {
            document.getElementById('localCount').innerText = localStorage.getItem('myMilkTeaCount') || '0';
            // è‡ªåŠ¨å¡«å……ä¸Šæ¬¡å¡«å†™çš„æ˜µç§°
            document.getElementById('usernameInput').value = localStorage.getItem('myNickname') || '';
        };

        // å“ç‰Œé€‰æ‹©é€»è¾‘
        window.selectBrand = function(btn, value) {
            document.querySelectorAll('.brand-btn').forEach(b => {
                b.classList.remove('border-amber-500', 'bg-amber-50', 'ring-2', 'ring-amber-200');
                b.classList.add('border-gray-100');
            });
            btn.classList.remove('border-gray-100');
            btn.classList.add('border-amber-500', 'bg-amber-50', 'ring-2', 'ring-amber-200');
            document.getElementById('selectedBrand').value = value;
        };
    </script>
</body>
</html>